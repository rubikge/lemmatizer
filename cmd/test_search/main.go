package main

import (
	"encoding/json"
	"fmt"

	"github.com/rubikge/lemmatizer/internal/models"
	"github.com/rubikge/lemmatizer/internal/repository"
	"github.com/rubikge/lemmatizer/internal/services"
	"github.com/rubikge/lemmatizer/internal/utils"
)

func main() {
	jsonData := []byte(`
{
  "common_positive_keywords": [
    "ищу",
    "нужен",
    "требуется",
    "посоветуйте",
    "помогите",
    "где",
    "купить",
    "заказать",
    "починить",
    "найти",
    "сколько",
    "стоимость",
    "цена",
    "подскажите",
    "срочно",
    "быстро",
    "недорого",
    "дешево",
    "ремонт",
    "велосипед",
    "вело",
    "запчасть",
    "прокат",
    "велопрокат",
    "покататься",
    "сломался",
    "помощь",
    "мастер",
    "сервис",
    "обслуживание",
    "восстановить",
    "выбрать",
    "какой",
    "лучший",
    "рекомендуете"
  ],
  "common_negative_keywords": [
    "предлагаю",
    "продаю",
    "делаю",
    "выполню",
    "мастер",
    "сервис",
    "ремонт",
    "обслуживание",
    "консультация",
    "настройка",
    "диагностика",
    "веломастер",
    "велосервис"
  ],
  "products": [
    {
      "product_title": "Ремонт велосипедов",
      "required_keywords": [
        "ремонт",
        "велосипед"
      ],
      "min_count_words": 3,
      "waight": 0.9,
      "keywords_with_synonyms": [
        {
          "sinonyms": [
            "велосипед",
            "вело",
            "байк",
            "велик",
            "великий"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "ремонт",
            "починка",
            "наладка",
            "исправление",
            "восстановление",
            "чинить",
            "починить",
            "наладить",
            "исправить",
            "восстановить"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "сломать",
            "ломаться",
            "поломаться",
            "неисправность",
            "поломка",
            "дефект",
            "разбиться",
            "авария"
          ],
          "waight": 0.5
        },
        {
          "sinonyms": [
            "обслуживание",
            "техосмотр",
            "то",
            "диагностика",
            "проверка",
            "осмотр"
          ],
          "waight": 0.4
        },
        {
          "sinonyms": [
            "настройка",
            "регулировка",
            "отрегулировать",
            "настроить"
          ],
          "waight": 0.3
        },
         {
          "sinonyms": [
            "колесо",
            "камера",
            "покрышка",
            "шина",
            "спица"
          ],
          "waight": 0.2
        }
      ]
    },
    {
      "product_title": "Запчасти для велосипедов",
      "required_keywords": [
        "запчасть",
        "велосипед"
      ],
      "min_count_words": 3,
      "waight": 0.8,
      "keywords_with_synonyms": [
        {
          "sinonyms": [
            "запчасть",
            "деталь",
            "комплектующее",
            "аксессуар",
            "компонент"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "велосипед",
            "вело",
            "байк",
            "велик",
            "великий"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "купить",
            "заказать",
            "приобрести",
            "найти",
            "где",
            "покупка"
          ],
          "waight": 0.5
        },
        {
          "sinonyms": [
            "камера",
            "покрышка",
            "шина",
            "колесо",
            "тормоз",
            "колодка",
            "цепь",
            "звезда",
            "переключатель",
            "седло",
            "руль",
            "рама",
            "вилка",
            "педаль"
          ],
          "waight": 0.6
        },
        {
          "sinonyms": [
            "оригинал",
            "аналог",
            "совместимый",
            "замена",
            "дубликат"
          ],
          "waight": 0.3
        }
      ]
    },
    {
      "product_title": "Прокат велосипедов",
      "required_keywords": [
        "прокат",
        "велосипед"
      ],
      "min_count_words": 3,
      "waight": 0.7,
      "keywords_with_synonyms": [
        {
          "sinonyms": [
            "прокат",
            "аренда",
            "напрокат",
            "арендовать",
            "дать"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "велосипед",
            "вело",
            "байк",
            "велик",
            "покататься",
            "кататься"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "день",
            "час",
            "сутки",
            "неделя",
            "время"
          ],
          "waight": 0.5
        },
        {
          "sinonyms": [
            "цена",
            "стоимость",
            "сколько",
            "оплата",
            "тариф"
          ],
          "waight": 0.4
        },
        {
          "sinonyms": [
            "детский",
            "взрослый",
            "горный",
            "шоссейный",
            "электровелосипед"
          ],
          "waight": 0.3
        },
        {
          "sinonyms": [
            "где",
            "найти",
            "ближайший",
            "место",
            "адрес",
            "локация"
          ],
          "waight": 0.2
        }
      ]
    },
    {
      "product_title": "Велосипед",
      "required_keywords": [
        "велосипед"
      ],
      "min_count_words": 2,
      "waight": 0.6,
      "keywords_with_synonyms": [
        {
          "sinonyms": [
            "велосипед",
            "вело",
            "байк",
            "велик",
            "великий"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "купить",
            "выбрать",
            "какой",
            "посоветовать",
            "рекомендовать",
            "где",
            "смотреть"
          ],
          "waight": 0.6
        },
        {
          "sinonyms": [
            "детский",
            "взрослый",
            "горный",
            "шоссейный",
            "городской",
            "bmx",
            "электровелосипед",
            "складной"
          ],
          "waight": 0.5
        },
        {
          "sinonyms": [
            "цена",
            "стоимость",
            "сколько",
            "бюджет",
            "недорого",
            "дешево"
          ],
          "waight": 0.4
        },
        {
          "sinonyms": [
            "новый",
            "бу",
            "подержанный",
            "состояние",
            "комплектация"
          ],
          "waight": 0.3
        },
         {
          "sinonyms": [
            "рама",
            "вилка",
            "колеса",
            "тормоза",
            "переключатель",
            "седло"
          ],
          "waight": 0.2
        }
      ]
    },
     {
      "product_title": "Тюнинг велосипедов",
      "required_keywords": [
        "тюнинг",
        "велосипед"
      ],
      "min_count_words": 3,
      "waight": 0.3,
      "keywords_with_synonyms": [
        {
          "sinonyms": [
            "тюнинг",
            "апгрейд",
            "улучшение",
            "модификация",
            "кастомизация"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "велосипед",
            "вело",
            "байк",
            "велик"
          ],
          "waight": 0.7
        },
        {
          "sinonyms": [
            "сделать",
            "улучшить",
            "поменять",
            "заменить"
          ],
          "waight": 0.5
        },
        {
          "sinonyms": [
            "седло",
            "руль",
            "колеса",
            "тормоза",
            "переключатели",
            "амортизатор",
            "фара",
            "фонарь",
            "крылья",
            "багажник",
            "подножка",
            "зеркало",
            "звонок",
            "насос",
            "фляга",
            "держатель",
            "сумка",
            "компьютер"
          ],
          "waight": 0.6
        }
      ]
    }
  ]
}
`)
	text := "Ищу качественный сервис, хочу отремонтировать мой велисапед. Что подскажете?"

	var product models.Product
	if err := json.Unmarshal(jsonData, &product); err != nil {
		fmt.Println(err)
	}

	r := repository.NewMystemRepository()
	s := services.NewLemmatizerService(r)

	lemmas, err := s.GetLemmas(text)
	if err != nil {
		fmt.Println(err)
	}

	searchProducts, err := utils.GetLemmatizedSearchProduct(&product, s)
	if err != nil {
		fmt.Println(err)
	}

	fmt.Println("Result ", services.GetScore(&lemmas, &searchProducts))

}
